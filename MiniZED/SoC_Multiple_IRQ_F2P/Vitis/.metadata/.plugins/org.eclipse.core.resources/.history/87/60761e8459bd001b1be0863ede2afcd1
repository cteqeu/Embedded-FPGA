// Developed by cteq.eu
// 25/05/2021

#include <stdio.h>
#include "platform.h"
#include "xil_printf.h"
#include "xparameters.h"
#include "xgpio.h"
#include "xstatus.h"
#include "sleep.h"
#include "xscugic.h"
#include "xil_exception.h"

#define INTC_GPIO_INTERRUPT_ID	XPAR_FABRIC_AXI_GPIO_0_IP2INTC_IRPT_INTR
#define INTC_DEVICE_ID	XPAR_SCUGIC_SINGLE_DEVICE_ID
#define GPIO_INTERRUPT_ID0	XPAR_GPIO_0_DEVICE_ID
#define GPIO_INTERRUPT_ID1  XPAR_GPIO_1_DEVICE_ID

#define INTC			XScuGic
#define INTC_HANDLER	XScuGic_InterruptHandler

#define GPIO_ALL_INPUTS	0xFFFF
#define INTERRUPT_CONTROL_VALUE 0x1
#define INTR_DELAY	0x00FFFFFF

static XGpio 	Gpio0;
static XGpio	Gpio1;
static XScuGic 	Intc;

static void SetupInterruptSystem(XScuGic *GicInstancePtr, XGpioPs *Gpio, u16 GpioIntrId);
static void DisableInterruptSystem(XScuGic *GicInstancePtr, XGpioPs *Gpio, u16 GpioIntrId);
static void IntrHandler0(void *CallBackRef, u32 Bank, u32 Status);
static void IntrHandler1(void *CallBackRef, u32 Bank, u32 Status);

static u16 GlobalIntrMask;
static volatile u32 IntrFlag;

int main()
{
	int Status;
	int Result;
	u32 DataRead;
	u32 Delay;
	init_platform();
    printf("SoC Multiple IRQ F2P Example by cteq.eu\n\r");
    printf("=======================================\n\r");
    printf("Use PIN L15 and P13 as Interrup input pins\n\r");

    Status= XGpio_Initialize(&Gpio0, GPIO_INTERRUPT_ID0);
    if (Status != XST_SUCCESS) {
    		return XST_FAILURE;
    }

    Status= XGpio_Initialize(&Gpio1, GPIO_INTERRUPT_ID1);
    if (Status != XST_SUCCESS) {
    		return XST_FAILURE;
    }

	Status = GpioSetupIntrSystem(IntcInstancePtr, InstancePtr, DeviceId,
					IntrId, IntrMask);
	if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}

	Status = GpioSetupIntrSystem(IntcInstancePtr, InstancePtr, DeviceId,
					IntrId, IntrMask);
	if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}


    while(1)
    {
    	usleep_A9(10);
    }
    //DisableInterruptSystem for XPGPIO_0
    //DisableInterruptSystem for XPGPIO_1
    cleanup_platform();
    return 0;
}


static void SetupInterruptSystem(XScuGic *GicInstancePtr, XGpioPs *Gpio, u16 GpioIntrId)
{



}

void DisableInterruptSystem(INTC *IntcInstancePtr, XGpio *InstancePtr, u16 IntrId, u16 IntrMask)
{
	XGpio_InterruptDisable(InstancePtr, IntrMask);
	XScuGic_Disable(IntcInstancePtr, IntrId);
	XScuGic_Disconnect(IntcInstancePtr, IntrId);
	return;
}
